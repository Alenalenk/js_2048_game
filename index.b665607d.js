var t={};t=class{constructor(t){this.initialState=t||[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.gameState=this.initialState.map(t=>[...t]),this.gameStatus="idle",this.gameScore=0,this.zeroCell=16,this.number=[2,2,2,2,2,2,2,2,2,4]}random(t){return Math.floor(Math.random()*(t+1))}addNewCell(){let t=[];for(let e=0;e<this.gameState.length;e++)for(let a=0;a<this.gameState[e].length;a++)0===this.gameState[e][a]&&t.push([e,a]);if(t.length>0){let[e,a]=t[this.random(t.length-1)];this.gameState[e][a]=this.number[this.random(9)],this.zeroCell--}}checkinitialState(){let t=0;for(let e=0;e<this.gameState.length;e++)for(let a=0;a<this.gameState[e].length;a++)0===this.gameState[e][a]?t++:2048===this.gameState[e][a]&&(this.gameStatus="win");this.zeroCell=t,0!==t||this.canMove()||(this.gameStatus="lose")}canMove(){for(let t=0;t<this.gameState.length;t++)for(let e=0;e<this.gameState[t].length;e++)if(0===this.gameState[t][e]||e<this.gameState[t].length-1&&this.gameState[t][e]===this.gameState[t][e+1]||t<this.gameState.length-1&&this.gameState[t][e]===this.gameState[t+1][e])return!0;return!1}moveLeft(){if("playing"!==this.gameStatus)return;let t=[],e=0;for(let a=0;a<this.gameState.length;a++){let i=this.gameState[a].filter(t=>0!==t);for(let t=0;t<i.length-1;t++)i[t]===i[t+1]&&(i[t]*=2,i[t+1]=0,e+=i[t]);for(i=i.filter(t=>0!==t);i.length<4;)i.push(0);t.push(i)}JSON.stringify(t)!==JSON.stringify(this.gameState)&&(this.gameState=t,this.addNewCell(),this.gameScore+=e,this.checkinitialState())}moveRight(){if("playing"!==this.gameStatus)return;let t=[],e=0;for(let a=0;a<this.gameState.length;a++){let i=this.gameState[a].filter(t=>0!==t);for(let t=i.length-1;t>0;t--)i[t]===i[t-1]&&(i[t]*=2,i[t-1]=0,e+=i[t]);for(i=i.filter(t=>0!==t);i.length<4;)i.unshift(0);t.push(i)}JSON.stringify(t)!==JSON.stringify(this.gameState)&&(this.gameState=t,this.addNewCell(),this.gameScore+=e,this.checkinitialState())}moveUp(){if("playing"!==this.gameStatus)return;let t=[[],[],[],[]],e=0;for(let a=0;a<this.gameState.length;a++){let i=[this.gameState[0][a],this.gameState[1][a],this.gameState[2][a],this.gameState[3][a]];i=i.filter(t=>0!==t);for(let t=0;t<i.length-1;t++)i[t]===i[t+1]&&(i[t]*=2,i[t+1]=0,e+=i[t]);for(i=i.filter(t=>0!==t);i.length<4;)i.push(0);for(let e=0;e<this.gameState.length;e++)t[e][a]=i[e]}JSON.stringify(t)!==JSON.stringify(this.gameState)&&(this.gameState=t,this.addNewCell(),this.gameScore+=e,this.checkinitialState())}moveDown(){if("playing"!==this.gameStatus)return;let t=[[],[],[],[]],e=0;for(let a=0;a<this.gameState.length;a++){let i=[this.gameState[0][a],this.gameState[1][a],this.gameState[2][a],this.gameState[3][a]];i=i.filter(t=>0!==t);for(let t=i.length-1;t>0;t--)i[t]===i[t-1]&&(i[t]*=2,i[t-1]=0,e+=i[t]);for(i=i.filter(t=>0!==t);i.length<4;)i.unshift(0);for(let e=0;e<this.gameState.length;e++)t[e][a]=i[e]}JSON.stringify(t)!==JSON.stringify(this.gameState)&&(this.gameState=t,this.addNewCell(),this.gameScore+=e,this.checkinitialState())}getScore(){return this.gameScore}getState(){return this.gameState}getStatus(){return this.gameStatus}start(){this.addNewCell(),this.addNewCell(),this.gameStatus="playing"}restart(){this.gameState=this.initialState.map(t=>[...t]),this.gameStatus="idle",this.gameScore=0,this.zeroCell=16}};const e=[...document.querySelectorAll(".field-row")],a=document.querySelector(".game-score"),i=document.querySelector(".start"),s=document.querySelector(".message-win"),l=document.querySelector(".message-lose"),r=document.querySelector(".message-start"),h=new t,g=()=>{if("win"===h.getStatus()){s.classList.remove("hidden"),document.removeEventListener("keydown",n),h.gameStatus="playing";return}if("lose"===h.getStatus()){l.classList.remove("hidden"),document.removeEventListener("keydown",n),h.gameStatus="playing";return}for(let t=0;t<h.gameState.length;t++){let a=[...e[t].querySelectorAll(".field-cell")];for(let e=0;e<h.gameState[t].length;e++){let i=a[e],s=h.gameState[t][e];0===s&&i.textContent>0&&(i.classList.remove(`field-cell--${i.textContent}`),i.textContent=""),s>0&&(i.classList.remove(`field-cell--${i.textContent}`),i.classList.add(`field-cell--${s}`),i.textContent=s)}}a.textContent=h.gameScore},n=t=>{switch(t.key){case"ArrowLeft":h.moveLeft();break;case"ArrowRight":h.moveRight();break;case"ArrowUp":h.moveUp();break;case"ArrowDown":h.moveDown();break;default:return}g()};i.addEventListener("click",()=>{document.addEventListener("keydown",n),"playing"===h.getStatus()&&(h.restart(),l.classList.add("hidden"),s.classList.add("hidden")),"idle"===h.getStatus()&&(h.start(),i.classList.remove("start"),i.classList.add("restart"),i.textContent="Restart",r.classList.add("hidden")),g()});
//# sourceMappingURL=index.b665607d.js.map
